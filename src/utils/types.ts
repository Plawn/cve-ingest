import oneCVE from "../example/oneCVE.json" assert { type: "json" };
import oneCPE from "../example/oneCPE.json" assert { type: "json" };

export type EmptyObject = Record<string | number | symbol, never>;

export type BaseCVESearch = {
  id: string;
  summary?: string;
  cwe: string;
  assigner: string;
  "Published": Date;
  "Modified": Date;
  "last-modified": Date;
  access: Partial<Access>;
  impact: Partial<Impact>;
  exploitability3: Partial<Exploitability3>;
  impact3: Partial<Impact3>;
  cvss3: number | null;
  "cvss3-vector": string | null;
  impactScore3: number;
  exploitabilityScore3: number;
  references: string[];

  cvss: number | null;
  exploitabilityScore: number;
  impactScore: number;
  "cvss-time": Date;

  "cvss-vector": string;
  vulnerable_configuration_cpe_2_2: string[];
};


export type CVESearch = BaseCVESearch & {
  vulnerable_product_stems: Set<string>;
  products: Set<string>;
  vendors: Set<string>;
  vulnerable_configuration: Set<string>;
  vulnerable_product: Set<string>;
  vulnerable_configuration_stems: Set<string>;
  cpe_id: string;
};

export type Impact = {
  availability: string;
  confidentiality: string;
  integrity: string;
};

export type Impact3 = {
  availability: string;
  confidentiality: string;
  integrity: string;
};

// TODO: finish
// deno-lint-ignore ban-types
export type Access = {};

// TODO: finish
// deno-lint-ignore ban-types
export type Exploitability3 = {};

export type ExportedCVESearch = BaseCVESearch & {
  vulnerable_product_stems: Array<string>;
  products: Array<string>;
  vendors: Array<string>;
  vulnerable_configuration: Array<string>;
  vulnerable_product: Array<string>;
  vulnerable_configuration_stems: Array<string>;
};

export type SetKeys =
| "vulnerable_product_stems"
| "products"
| "vendors"
| "vulnerable_configuration"
| "vulnerable_product"
| "vulnerable_configuration_stems";

export type BaseChunk = {
  page: number;
  expectedPages: number;
  start: Date;
  end: Date;
  hasRemaining: boolean;
};

export type CpeChunk = BaseChunk & {
  result: CPENVDResult
}

export type CveChunk = BaseChunk & {
  result: CVENVDResult;
}

export type BulkWriteResult = {
  insertedCount: number;
  matchedCount: number;
  modifiedCount: number;
  deletedCount: number;
  upsertedCount: number;
};

export type BaseCPESearch = {
  id: string;
  product: string;
  "created_at": Date;
  "updated_at": Date;
  version: string;
  cpe: string;
}

export type CPESearch = BaseCPESearch;
/**
 * {
_id: ObjectId('636cddc804e3f99704fa050a'),
id: '786f8c77c06be03648666200430bf54309115fe7',
cpe_2_2: 'cpe:2.3:a:10-strike:network_monitor:5.4:*:*:*:*:*:*:*',
cpe_name: [
  {
    cpe23Uri: 'cpe:2.3:a:10-strike:network_monitor:5.4:*:*:*:*:*:*:*'
  }
],
product: 'network_monitor',
title: '10-Strike Network Monitor 5.4',
    vendor: '10-strike'
}
 */

export type CPEInfos = {
  cpe_name: { cpe23Uri: string }[];
};

export type CVENVDResult = typeof oneCVE;
export type FullCVENVD = typeof oneCVE.vulnerabilities[0];
export type CVENVD = FullCVENVD["cve"];

export type CPENVDResult = typeof oneCPE;
export type FullCPENVD = typeof oneCPE.products[0];
export type CPENVD = FullCPENVD["cpe"];


declare const tag: unique symbol;

declare type Tagged<Token> = {
  readonly [tag]: Token;
};
export type Opaque<Type, Token = unknown> = Type & Tagged<Token>;

export type Milliseconds = Opaque<number, "ms">;


// if id = 1 : CPE update if id = 2 : CVE update
export type Update = {
  id: string,
  last_update: Date;
}